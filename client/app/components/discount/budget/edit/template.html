<!-- 优惠信息限制 -->
<div class="row">
  <div class="col-xs-11">
    <table class="table table-bordered budget-table">
      <tbody>
      <tr>
        <td>OA信息
        </th>
        <td>
          <p>OA编号：{{vm.oaInfo.oaNumber}}</p>

          <p>OA总预算：{{vm.oaInfo.budget/100|number:2}}元</p>

          <p>OA预算剩余：{{vm.oaInfo.residualBudget/100|number:2}}元</p>

          <p>OA预算开始时间：{{vm.oaInfo.oaBeginTime}}</p>

          <p>OA预算结束时间：{{vm.oaInfo.oaEndTime}}</p>

          <p>活动总预算：{{vm.rule.total/100|number:2}}元</p>

          <p>活动预算剩余：{{(vm.rule.total/100 - (vm.rule.used == 0 ? 0:vm.rule.used/100))|number:2}}元</p>
        </td>
      </tr>
      <tr>
        <td>
          <span class="require-star">*</span>活动总预算
        </th>
        <td>
          <input type="text" ng-model="totalAmount"
                 ng-disabled="vm.oaInfo.status == 1 || vm.oaInfo.status == 4 || vm.oaInfo.status == 5 || vm.oaInfo.status == 6">元/活动期
        </td>
      </tr>
      <tr>
        <td><span>活动预算分段控制：</span></td>
        <td>
          <div ng-init="bands.length?'':vm.rule.type='1'">
            <label>
              <input type="radio" value="1" ng-model="vm.rule.type" ng-disabled="vm.oaInfo.status == 5 || bands.length">
              按照元限制
            </label>
            <!--<label>
              <input type="radio" value="0" ng-model="vm.rule.type" ng-disabled="vm.oaInfo.status == 5 || bands.length">
              按照次数限制
            </label>-->

            <div>
              <button ng-click="vm.callBudgetSectionModal('lg', 'add', vm.rule.type)"
                      ng-if="vm.oaInfo.status != 6 "
                      class="btn bp-btn-primary">添加
              </button>
            </div>
          </div>
          <div ng-init="!bands ?bands=[]:''"
               style="padding: 10px 0">
            <div ng-repeat="band in bands"
                 style="margin: 10px 0">
              <div>
                {{band.startAt}} —— {{band.endAt}}
                <span style="margin-left: 15px">{{band.value}}元/次</span>
                <button class="btn bp-btn-primary"
                        style="margin-left: 10px"
                        ng-if="(vm.oaInfo.status != 4 || vm.oaInfo.status != 6) && !band.$isDisable"
                        ng-click="vm.callBudgetSectionModal('lg', 'edit', vm.rule.type, band, $index)">编辑
                </button>
                <button class="btn bp-btn-primary"
                        ng-click="vm.delBudgetSection(band.id)"
                        ng-if="(vm.oaInfo.status != 4 || vm.oaInfo.status != 6) && $last && !band.$isDisable">删除
                </button>
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td>活动预算分段预警：</td>
        <td>
          <fieldset ng-disabled="vm.oaInfo.status == 6">
            <div>
              <label><input ng-model="vm.budgetalert.isOpenAlert"
                            ng-true-value="1"
                            ng-false-value="0"
                            type="checkbox"/>开启预警</label>
            </div>
            <div ng-if="vm.budgetalert.isOpenAlert == 1">
              剩余波段预算占波段总预算
              <input ng-model="vm.budgetalert.alertRatio" type="number"/>%时 ，
              每单随机减
              <input ng-model="vm.budgetalert.minus" type="number"/>元
            </div>
          </fieldset>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
<!-- /优惠信息限制 -->

<!-- 广场优惠限制
<div class="row">
  <label class="col-xs-4 control-label">广场预算控制(请注意此区域为实时保存)</label>

  <div class="col-xs-11">
    <input type="text" ng-model="filters.plazaName" placeholder="广场名称" class="discount-addplaza">
            <span class="discount-add-del-button">
              <button type="button" ng-click="vm.addPlaza()" ng-show="totalAmount">添加广场</button>
              <button ng-show="selectedPlazaIDs.length > 0" type="button" ng-click="vm.delBatch()">批量删除</button>
            </span>
  </div>
  <div class="col-xs-11">
    <table class="table table-bordered" ng-table="tableParams">
      <thead>
      <tr>
        <th>全选<input type="checkbox" ng-model="selectedAll" ng-click="vm.selectAll()"></th>
        <th>广场</th>
        <th ng-show="vm.rule.type == 0">限制次数/活动期
          <button ng-show="tableParams.data.length >0" type="button" ng-click="vm.totalLimitation()">复制</button>
        </th>
        <th ng-show="vm.rule.type == 1">限制预算/活动期
          <button ng-show="tableParams.data.length >0" type="button" ng-click="vm.totalLimitation()">复制</button>
        </th>
        <th ng-show="vm.rule.type == 0">限制次数/天
          <button ng-show="tableParams.data.length >0" type="button" ng-click="vm.dailyLimitation()">复制</button>
        </th>
        <th ng-show="vm.rule.type == 1">限制预算/天
          <button ng-show="tableParams.data.length >0" type="button" ng-click="vm.dailyLimitation()">复制</button>
        </th>
        <th>操作</th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="row in $data track by row.id">
        <th scope="row"><input type="checkbox" ng-model="row.plazaSelected"></th>
        <td>{{row.plazaName}}</td>
        <td ng-show="vm.rule.type == 0">
          <input ng-class="{'has-error':row.error}" type="number" min=0 max=100000000
                 ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 1000, 'blur': 0 } }"
                 ng-model="row.totalLimitation" ng-change="changeDailyLimitation(0,row)">次
          <p ng-show="row.error"><i class="fa fa-info-circle"></i>{{row.errmsg}}</p>
        </td>
        <td ng-show="vm.rule.type == 1">
          <input ng-class="{'has-error':row.error}" type="number" min=0 max=100000000
                 ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 1000, 'blur': 0 } }"
                 ng-model="row.totalLimitation" ng-change="changeDailyLimitation(1,row)">元
          <p ng-show="row.error"><i class="fa fa-info-circle"></i>{{row.errmsg}}</p>
        </td>
        <td ng-show="vm.rule.type == 0">
          <input ng-class="{'has-error':row.error}" type="number" min=0 max=100000000
                 ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 1000, 'blur': 0 } }"
                 ng-model="row.dailyLimitation" ng-change="changeDailyLimitation(0,row)">次
          <p ng-show="row.error"><i class="fa fa-info-circle"></i>{{row.errmsg}}</p>
        </td>
        <td ng-show="vm.rule.type == 1">
          <input ng-class="{'has-error':row.error}" type="number" min=0 max=100000000
                 ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 1000, 'blur': 0 } }"
                 ng-model="row.dailyLimitation" ng-change="changeDailyLimitation(1,row)">元
          <p ng-show="row.error"><i class="fa fa-info-circle"></i>{{row.errmsg}}</p>
        </td>
        <td>
          <button type="button" ng-click="vm.delPlaza(row)">删除</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
 /广场优惠限制

 补贴规则设置
<div class="row">
  <label class="col-xs-2 control-label"><span class="require-star">*</span>补贴规则设置</label>

  <div class="col-xs-11">
    <table class="table table-bordered">
      <thead>
      <tr>
        <th>补贴方式</th>
        <th>第三方每单补贴量</th>
        <th>商户每单补贴量</th>
        <th>飞凡每单补贴量</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <th scope="row">比例</th>
        <td><input type="text" value="0" disabled>%</td>
        <td><input type="text" value="0" disabled>%</td>
        <td><input type="text" value="100" disabled>%</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
 /补贴规则设置

 活动进度控制
<div class="row">
  <div class="col-xs-11">
    <label>活动进度控制</label>
    <span><input type="radio" ng-model="isLimit" value="0">不限制</span>
    <span ng-show="vm.rule.dailyLimitationTimes>0 || vm.rule.dailyLimitationAmount > 0"><input type="radio" ng-model="isLimit" value="1">限制</span>
  </div>
</div>
<div class="row" ng-show="isLimit == 1 ">
  <div class="col-xs-11">
    <button type="button" ng-click="vm.addProgressRestrict()">增加限制</button>
  </div>
</div>

<div class="row" ng-show="isLimit == 1 " ng-repeat="item in distributions">
  <div class="col-xs-11">
    <form class="form-inline">
      <div class="form-group">
        <uib-timepicker ng-model="item.beginTime" hour-step="1" minute-step="1" show-meridian="false"></uib-timepicker>
      </div>
      <div class="form-group">
        <span>&#45;&#45;</span>
      </div>
      <div class="form-group">
        <uib-timepicker ng-model="item.endTime" hour-step="1" minute-step="1" show-meridian="false"></uib-timepicker>
      </div>
      <div class="form-group">
        <input type="text" ng-model="item.amount">%
      </div>
      <div class="form-group">
        <button type="button" ng-click="vm.delRestrict($index,item)">删除</button>
      </div>
    </form>
  </div>
</div>
 /活动进度控制 -->

<!-- 保存 -->
<div class="row">
  <div class="col-xs-offset-2">
    <button type="button" class="btn bp-btn-primary" ng-click="vm.saveBudget()"
            ng-disabled="vm.rule.dailyLimitationTimes > vm.rule.totalLimitationTimes || vm.rule.dailyLimitationTimes * minus > vm.oaInfo.remainingBudget/100 || vm.rule.totalLimitationTimes * minus > vm.oaInfo.remainingBudget/100 || vm.rule.dailyLimitationAmount > vm.rule.totalLimitationAmount || vm.rule.dailyLimitationAmount > vm.oaInfo.remainingBudget/100 || vm.rule.totalLimitationAmount > vm.oaInfo.remainingBudget/100">
      保存
    </button>
  </div>
</div>
<!--/保存 -->
<h3 class="bg-primary" style="line-height: 30px;font-size: 16px;color: white;padding: 0 20px">预算消耗跟踪列表</h3>
<table class="table table-striped table-hover" ng-table="vm.tableParamsOfBudget">
  <thead>
  <tr>
    <th>日期</th>
    <th>总预算</th>
    <th>叠加预算</th>
    <th>总预算锁定</th>
    <th>总预算消耗</th>
    <th>总支付成功笔数</th>
    <th>总支付应付金额</th>
    <th>总支付实付金额</th>
  </tr>
  </thead>
  <tbody>
  <tr ng-repeat="row in $data" ng-if="row.startAt*1000 <= vm.now">
    <td> {{row.startAt*1000|date:'yyyy-MM-dd HH:mm:ss'}} - {{row.endAt*1000|date:'yyyy-MM-dd HH:mm:ss'}}</td>
    <td> {{row.value/100}}</td>
    <td> {{row.left/100}}</td>
    <td> {{row.locked/100}}</td>
    <td> {{row.used/100}}</td>
    <td> {{row.successCount}}</td>
    <td> {{row.amountSum/100}}</td>
    <td> {{(row.amountSum-row.minusSum)/100}}</td>
  </tr>
  <tr class="lx-list-sp-tr" ng-if="!$data || !$data.length">
    <td colspan="10" style="text-align: center">
      <div class="text-center" ng-show="vm.tableParamsOfBudget">
        <i class="glyphicon glyphicon-refresh">数据加载中...</i>
      </div>
      <div class="text-center" ng-if="!vm.tableParamsOfBudget && (!$data || !$data.length)">
        <i class="glyphicon glyphicon-remove"></i>没有记录
      </div>
    </td>
  </tr>
  </tbody>
</table>

<h3 class="bg-primary" style="line-height: 30px;font-size: 16px;color: white;padding: 0 20px">操作日志</h3>
<table class="table table-striped table-hover" ng-table="vm.tableParams">
  <thead>
  <tr>
    <th>操作时间</th>
    <th>操作人</th>
    <th>操作内容</th>
  </tr>
  </thead>
  <tbody>
  <tr ng-repeat="row in $data">
    <td> {{row.create_time}}</td>
    <td> {{row.create_name}}</td>
    <td> {{row.action}}</td>
  </tr>
  <tr class="lx-list-sp-tr" ng-if="!$data || !$data.length">
    <td colspan="10" style="text-align: center">
      <div class="text-center" ng-show="vm.loading">
        <i class="glyphicon glyphicon-refresh">数据加载中...</i>
      </div>
      <div class="text-center" ng-if="!vm.loading && (!$data || !$data.length)">
        <i class="glyphicon glyphicon-remove"></i>没有记录
      </div>
    </td>
  </tr>
  </tbody>
</table>
